<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Construtor Lógico</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous" defer></script>
  <style>
    .step {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .step-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .step-body {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container-fluid mt-5 bg-dark text-light p-5">
    <h1>Construtor Lógico</h1>
    <form id="logicConstructorForm">
      <div class="form-group bg-light p-5 text-dark">
        <label for="steps">Construtor Lógico</label>
        <div id="steps"></div>
        <button type="button" class="btn btn-primary mt-3" id="addStepButton">Adicionar Passo</button>
      </div>
      <button type="submit" class="btn btn-success m-3">Enviar</button>
    </form>
  </div>

  <script>
    // Definindo o JSON diretamente no JavaScript
    const stepTemplates = {
      "addAttribute": {
        "title": "Adicionar Atributo",
        "fields": [
          {
            "label": "Atributo",
            "type": "text",
            "class": "attribute",
            "placeholder": "Nome do Atributo"
          },
          {
            "label": "Pontos",
            "type": "number",
            "class": "points",
            "placeholder": "Número de Pontos"
          },
          {
            "label": "Observações",
            "type": "text",
            "class": "notes",
            "placeholder": "Observações (opcional)"
          }
        ]
      },
      "anotherStep": {
        "title": "Outro Passo",
        "fields": [
          {
            "label": "Campo Exemplo",
            "type": "text",
            "class": "example",
            "placeholder": "Exemplo de Campo"
          }
          // Adicione mais campos conforme necessário
        ]
      }
    };

    document.addEventListener('DOMContentLoaded', (event) => {
        const stepsContainer = document.getElementById('steps');
        const addStepButton = document.getElementById('addStepButton');
      
        addStepButton.addEventListener('click', () => {
          addStep();
        });
      
        function addStep() {
          const step = document.createElement('div');
          step.className = 'step';
      
          const stepHeader = document.createElement('div');
          stepHeader.className = 'step-header';
          stepHeader.innerHTML = `
            <span class="step-title">${stepTemplates["addAttribute"].title}</span>
            <button type="button" class="btn btn-secondary btn-sm toggle-step-button">Expandir</button>
          `;
      
          const stepBody = document.createElement('div');
          stepBody.className = 'step-body';
          stepBody.innerHTML = `
            <div class="form-group">
              <label for="stepType">Tipo de Passo</label>
              <select class="form-control step-type">
                ${Object.keys(stepTemplates).map(type => `<option value="${type}">${stepTemplates[type].title}</option>`).join('')}
              </select>
            </div>
            <div class="step-fields"></div>
            <button type="button" class="btn btn-danger remove-step-button">Remover Passo</button>
          `;
      
          step.appendChild(stepHeader);
          step.appendChild(stepBody);
          stepsContainer.appendChild(step);
      
          const stepTypeSelect = stepBody.querySelector('.step-type');
          stepTypeSelect.addEventListener('change', (event) => {
            updateStepFields(stepBody, event.target.value);
          });
      
          const toggleStepButton = stepHeader.querySelector('.toggle-step-button');
          toggleStepButton.addEventListener('click', () => {
            if (stepBody.style.display === 'none') {
              stepBody.style.display = 'block';
              toggleStepButton.textContent = 'Comprimir';
            } else {
              stepBody.style.display = 'none';
              toggleStepButton.textContent = 'Expandir';
            }
          });
      
          const removeStepButton = stepBody.querySelector('.remove-step-button');
          removeStepButton.addEventListener('click', () => {
            step.remove();
          });
      
          // Inicializar os campos do primeiro tipo de passo
          updateStepFields(stepBody, stepTypeSelect.value);
        }
      
        function updateStepFields(stepBody, stepType) {
          const stepFieldsContainer = stepBody.querySelector('.step-fields');
          stepFieldsContainer.innerHTML = '';
          const fields = stepTemplates[stepType].fields;
      
          fields.forEach(field => {
            const fieldElement = document.createElement('div');
            fieldElement.className = 'form-group';
            fieldElement.innerHTML = `
              <label for="${field.class}">${field.label}</label>
              <input type="${field.type}" class="form-control ${field.class}" placeholder="${field.placeholder}">
            `;
            stepFieldsContainer.appendChild(fieldElement);
          });
        }
      
        document.getElementById('logicConstructorForm').addEventListener('submit', (event) => {
          event.preventDefault();
      
          const steps = [];
          document.querySelectorAll('.step').forEach(stepElement => {
            const step = {
              type: stepElement.querySelector('.step-type').value,
              fields: {}
            };
            stepElement.querySelectorAll('.form-control').forEach(input => {
              step.fields[input.classList[1]] = input.value;
            });
            steps.push(step);
          });
      
          console.log('Passos:', steps);
        });
      });
  </script>
</body>
</html>
